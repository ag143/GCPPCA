
# Google Cloud: Professional Cloud Architect (PCA) Exam Notes – Part V
*Apr 5, 2023*

**Categories**: Cloud, GCP  
**Reading Time**: 11 min

## Review Compute Options

### Google Backup & DR 
- A managed service to ensure resilience and reliability for data generated by Google Cloud or on-premises infrastructure.
- Backups are necessary to recover from user error, malicious activity, or other reasons.
- Offers a centralized backup management solution across services.
- Uses Cloud Storage to efficiently manage storage costs (only incremental data is saved, and you can select the appropriate storage class).
- Minimizes recovery times.

### Virtual Machines
- Enabling the Compute Engine API creates a Service Account (IAM), the OS Login API is also enabled.
- You can set the default regions and zones in gcloud config settings.
- GCP offers rightsizing support, if you want to look at metrics yourself you will need the Stackdriver logging agent installed.
- GCE will tell you if you’re underutilizing your VM.
- You must stop the VM to change CPU/RAM.
- Use custom machine types if your VM’s CPU/RAM requirements don’t fit a predefined machine type.
- Use VMs if you need to add GPUs to workloads, good for ML and data processing – GKE can now support GPUs.
- NoOps solutions are products like Google App Engine and Google Kubernetes Engine, any compute instance VM will have some ops and are not “no-ops”.

### Special Types of VMs
- **Shielded VMs**: Offer verifiable integrity of your VM instances to ensure they are not compromised by boot- or kernel-level malware or rootkits.
  - Leverage Secure Boot, with a virtual Trusted Platform Module (vTPM), and integrity monitoring.
- **Confidential VMs**: Encrypt data in use, with encryption and decryption happening within the CPU.
  - Little or no impact on most workloads, with only a 0-6% degradation in performance.
- **Preemptible VM instances**: Available at a much lower price (60-91% discount) but might be stopped (preempted) by Compute Engine.
- **Spot VMs**: The latest version of Preemptible VMs.
- **Tau VMs**: Offer the best price-performance ratio and are optimized for scale-out workloads.

### vCPUs
- **n1-highcpu**: Higher proportion of CPU to memory.
- **n1-highmem**: Higher proportion of memory to CPU.
- **n1-standard**: Balanced CPU and memory resources.
- 1 vCPU is equal to 1 hyperthread, and 2 vCPUs is equal to 1 core.

### Startup Scripts
- Use startup scripts to perform actions on your VM after boot such as installing software, running updates, turning on/off services.
  - From a local file: Use gcloud (`--metadata-from-file startup-script=PATH`) or copy/paste into GCP Console (256 KB limit on script).
  - From GCS: Specify `startup-script-url` as the metadata key and `gs://path/to/bucket/and/file` as the value (No size limit on script).

### Shutdown Scripts
- Create and run shutdown scripts that execute commands right before an instance is terminated or restarted.
  - From a local file: Use gcloud (`--metadata-from-file shutdown-script=PATH`) or copy/paste into GCP Console (256 KB limit on script).
  - From GCS: Specify `shutdown-script-url` as the metadata key and `gs://path/to/bucket/and/file` as the value (No size limit on script).

### Storage Options
| Storage Type | PD HDD | PD SSD | Local SSD | RAM disk |
|--------------|--------|--------|-----------|----------|
| Data Redundancy | Yes | Yes | No | No |
| Encryption at Rest | Yes | Yes | Yes | N/A |
| Snapshotting | Yes | Yes | No | No |
| Bootable | Yes | Yes | No | No |
| Use case | General, bulk file storage | Very random IOPS, Lower latency | High IOPS + low latency | Low latency + risk of data loss |

- **Local SSD**: Zonal 375GB SSD physically attached to servers, attached to a single instance, can be striped across up to 24 drives for 9TB.
  - All data will be lost when the instance shuts down!
- **Persistent Disk**: A zonal or regional block storage attached to an instance via a network (NAS).
  - PD Types: Standard (pd-standard), Balanced (pd-balanced), SSD (pd-ssd), Extreme (pd-extreme).
  - Network pipe is shared for network and disk I/O because these are network-attached block devices.
  - Max disk size for PD HDD or PD SSD is 65,536 GB (64 TB).
  - Most instances can have up to 128 attached PDs (for a maximum of 257 TB total).
  - Replicated for durability, stick around after you shut down an instance.
  - Can resize while they’re in use, you can resize up but never down.

### Network and Disk I/O
- 2 Gbps of network I/O per vCPU.
- Up to 16 Gbps of total bandwidth which means an 8 vCPU VM is required.
- Need more than 50K IOPS? Go to iSCSI or NVMe Local SSD with caveats.
- Only certain GCE images have optimized drivers for this, also look at partners like Nasuni or Dell PowerScale.

### Virtual Machine Best Practices
- Dynamically increase the size of a persistent SSD to get better throughput and IOPS performance.
- Distribute instances across zones or regions for high availability, use global HTTPS load balancer with health checks.
- VMs in Managed Instance Groups (MIGs) have auto-scaling and auto-healing capabilities.
- Use zone-specific internal DNS names.
- Create persistent disk snapshots as a backup mechanism.
- VMs that are backends for HTTPS and SSL Proxy load balancers do not need external IP addresses to be accessed privately through the load balancer.
- Host keys can be stored as guest attributes to add a layer of security.
- Each instance has a unique JSON web token (JWT) for verifying the instance's identity.

### SQL Server Best Practices
- Move data files and log files to a separate SSD persistent disk.
- Use a local SSD to improve IOPS for the tempdb and Windows paging files.
- Use Windows default firewall and network settings, install antivirus software and have a backup strategy.
- Set max degree of parallelism to 8.
- Install logging agent.

### Image Management Best Practices
- An image is a bundle of the raw bytes used to create a prepopulated disk.
  - Needs a master boot record and bootable partition to be bootable.
  - Image families cannot be stored in Cloud Storage by the end user, they must be in the Custom Images service.
  - Public Images for use at no extra cost, and also premium images like RHEL and Windows that incur hourly fees.
- If you use a startup script to deploy your applications as the instances boot, make sure the script is idempotent.
- The process of creating a custom image is called baking (manual, automated, or imported).
  - Recommended to shut down instances before creating a new custom image.
  - Images are encrypted by default but you can also bring your own key.
- Image Families help manage images in your project by grouping related images together.
- Images are good candidates to span multiple projects.

### Disk Snapshots
- Snapshots are a project-level resource but can now be shared across projects.
  - They are incremental; the first snapshot is full and subsequent ones only contain differences.
  - Can take a snapshot of a VM in one zone and create a new VM off of it in a different zone.
  - Organize data on separate persistent disks and use discard or fstrim on Linux before creating snapshots.
  - Snapshot creation usually peaks at midnight. Do it off hours for faster speeds.

### Unmanaged Instance Groups
- Collections of instances that are not necessarily identical and do not share a common instance template.
  - Best for load balancing dissimilar instances.
  - Autoscaling, autohealing, and rolling updates are not supported.
  - Each unmanaged instance group can contain a maximum of 500 instances.
  - Unmanaged instance groups have to be in one zone.
  - Deleting an unmanaged instance group leaves the underlying instances behind.

### Managed Instance Groups
- Instance templates are immutable.
  - Start with an instance template, set autoscaling rules with max/min number of VMs, cool-down period excludes newly created instances.
  - Auto-healing uses health checks to automatically restart VMs if necessary.
  - Deleting a managed instance group deletes the underlying VMs.
  - Supports autoscaling and rolling updates.

