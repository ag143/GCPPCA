<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monthly Aggregated Team Charts</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h2>Bar Chart (Aggregated Monthly Count by Team)</h2>
    <canvas id="barChart"></canvas>

    <h2>Line Chart (Aggregated Monthly Count by Team)</h2>
    <canvas id="lineChart"></canvas>

    <script>
        async function fetchData() {
            const response = await fetch('data.csv'); // Load CSV file
            const data = await response.text();
            if (err) {
                    console.error(err);
                    return;
                }
            const rows = data.split("\n").slice(1); // Skip header row
            
            let aggregatedData = {}; // Store aggregated counts

            rows.forEach(row => {
                if (err) {
                    console.error(err);
                    return;
                }
                const [date, month, team, count] = row.split(",");
                const monthTrimmed = month.trim();
                const teamTrimmed = team.trim();
                
                const countValue = parseInt(count.trim());

                if (!aggregatedData[monthTrimmed]) {
                    aggregatedData[monthTrimmed] = {};
                }
                if (!aggregatedData[monthTrimmed][teamTrimmed]) {
                    aggregatedData[monthTrimmed][teamTrimmed] = 0;
                }
                aggregatedData[monthTrimmed][teamTrimmed] += countValue;
            });

            const labels = Object.keys(aggregatedData); // Months
            const teams = [...new Set(rows.map(row => row.split(",")[2].trim()))]; // Unique teams

            let datasets = teams.map((team, index) => ({
                label: team,
                data: labels.map(month => aggregatedData[month][team] || 0),
                backgroundColor: `rgba(${index * 60}, ${100 + index * 30}, ${200 - index * 40}, 0.6)`,
                borderColor: `rgba(${index * 60}, ${100 + index * 30}, ${200 - index * 40}, 1)`,
                borderWidth: 2,
                fill: false
            }));

            return { labels, datasets };
        }

        async function createCharts() {
            const { labels, datasets } = await fetchData();

            // Bar Chart
            new Chart(document.getElementById("barChart"), {
                type: "bar",
                data: { labels, datasets },
                options: { responsive: true }
            });

            // Line Chart
            new Chart(document.getElementById("lineChart"), {
                type: "line",
                data: { labels, datasets },
                options: { responsive: true }
            });
        }

        createCharts(); // Call function to load and display charts
    </script>
</body>
</html>
